{"version":3,"file":"cart.js","sources":["stores/cart.js"],"sourcesContent":["import { defineStore } from \"pinia\";\r\nimport { ref, unref, computed } from \"vue\";\r\nimport { formatPrice } from \"@/utils/format.js\";\r\nimport { add as xe_add, multiply as xe_multiply } from \"xe-utils\";\r\n\r\nconst cartList = ref([]);\r\nexport const useCartStore = defineStore(\"cart\", () => {\r\n  // 购物车显示的商品件数\r\n  const goodsTotal = computed(() => {\r\n    return unref(cartList).reduce((total, item) => {\r\n      return xe_add(total, Number(item._countNum));\r\n    }, 0);\r\n  });\r\n\r\n  // 购物车显示的总价\r\n  const priceTotal = computed(() => {\r\n    let amount = unref(cartList).reduce((prev, current) => {\r\n      const result = xe_multiply(\r\n        Number(current._countNum),\r\n        Number(current._skuInfo.price),\r\n      );\r\n      return xe_add(prev, Number(result));\r\n    }, 0);\r\n    return formatPrice(amount, { digits: 2 });\r\n  });\r\n\r\n  const pushGoods = (data) => {\r\n    let {\r\n      _id,\r\n      _skuInfo: { _id: skuId },\r\n      _countNum,\r\n    } = data;\r\n\r\n    const index = unref(cartList).findIndex(\r\n      (item) => _id && skuId && item._id === _id && item._skuInfo._id === skuId,\r\n    );\r\n    if (index > -1) {\r\n      cartList.value[index]._countNum += _countNum;\r\n\r\n      return;\r\n    }\r\n    cartList.value.unshift(data);\r\n  };\r\n\r\n  // 计算购物车商品件数\r\n\r\n  return {\r\n    cartList,\r\n    pushGoods,\r\n    goodsTotal,\r\n    priceTotal,\r\n  };\r\n});\r\n"],"names":["ref","defineStore","computed","unref","xe_add","xe_multiply","formatPrice"],"mappings":";;;AAKA,MAAM,WAAWA,cAAAA,IAAI,CAAA,CAAE;AACX,MAAC,eAAeC,cAAAA,YAAY,QAAQ,MAAM;AAEpD,QAAM,aAAaC,cAAAA,SAAS,MAAM;AAChC,WAAOC,cAAAA,MAAM,QAAQ,EAAE,OAAO,CAAC,OAAO,SAAS;AAC7C,aAAOC,cAAAA,QAAAA,IAAO,OAAO,OAAO,KAAK,SAAS,CAAC;AAAA,IAC5C,GAAE,CAAC;AAAA,EACR,CAAG;AAGD,QAAM,aAAaF,cAAAA,SAAS,MAAM;AAChC,QAAI,SAASC,cAAAA,MAAM,QAAQ,EAAE,OAAO,CAAC,MAAM,YAAY;AACrD,YAAM,SAASE,cAAW,QAAA;AAAA,QACxB,OAAO,QAAQ,SAAS;AAAA,QACxB,OAAO,QAAQ,SAAS,KAAK;AAAA,MACrC;AACM,aAAOD,cAAM,QAAA,IAAC,MAAM,OAAO,MAAM,CAAC;AAAA,IACnC,GAAE,CAAC;AACJ,WAAOE,aAAW,YAAC,QAAQ,EAAE,QAAQ,EAAG,CAAA;AAAA,EAC5C,CAAG;AAED,QAAM,YAAY,CAAC,SAAS;AAC1B,QAAI;AAAA,MACF;AAAA,MACA,UAAU,EAAE,KAAK,MAAO;AAAA,MACxB;AAAA,IACD,IAAG;AAEJ,UAAM,QAAQH,cAAAA,MAAM,QAAQ,EAAE;AAAA,MAC5B,CAAC,SAAS,OAAO,SAAS,KAAK,QAAQ,OAAO,KAAK,SAAS,QAAQ;AAAA,IAC1E;AACI,QAAI,QAAQ,IAAI;AACd,eAAS,MAAM,KAAK,EAAE,aAAa;AAEnC;AAAA,IACD;AACD,aAAS,MAAM,QAAQ,IAAI;AAAA,EAC/B;AAIE,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AACA,CAAC;;"}