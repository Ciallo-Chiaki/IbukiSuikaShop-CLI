{"version":3,"file":"category.js","sources":["pages/shop/category.vue","../../EdgeDownload/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2hvcC9jYXRlZ29yeS52dWU"],"sourcesContent":["<script setup>\nimport { computed, unref, ref, nextTick } from \"vue\";\nimport { SYSTEM_WINDOW_INFO } from \"@/utils/config.js\";\nimport { navBarH } from \"@/utils/system.js\";\nimport { useGoodsCategoryApi, useGoodsDetailApi } from \"@/apis/goods.js\";\n\nconst { data: categoryList = [] } = useGoodsCategoryApi();\nconst { data: goodsDetail = {} } = useGoodsDetailApi();\n\nconst currentClassId = ref(\"\");\nconst mainScrollTop = ref(0);\nconst skuPopRef = ref(null);\nconst currentGoods = ref({});\n\nconst containerHeight = computed(() => {\n  let tabBarH = 0;\n  // #ifdef H5\n  tabBarH = 50;\n  // #endif\n\n  return `${\n    SYSTEM_WINDOW_INFO.windowHeight -\n    unref(navBarH) -\n    45 -\n    uni.rpx2px(100) -\n    tabBarH\n  }px`;\n});\n\nconst onClassTab = (item) => {\n  console.log(\"Selected category:\", item);\n  currentClassId.value = item._id;\n  mainScrollTop.value = item.top;\n};\n\nconst calcSize = () => {\n  let height = 0;\n  categoryList.forEach((item, index) => {\n    const view = uni.createSelectorQuery().select(`#module-${item._id}`);\n    view\n      .fields({ size: true }, (data) => {\n        item.top = Math.floor(height);\n        height += data.height;\n      })\n      .exec();\n  });\n  return height;\n};\n\nconst onMainScroll = (e) => {\n  let scrollTop = e.detail.scrollTop;\n  let results = categoryList.filter((item) => item.top <= scrollTop).reverse();\n  console.log(results);\n  if (results.length > 0) currentClassId.value = results[0]._id;\n};\n\nconst showSkuPop = (e) => {\n  console.log(e);\n  currentGoods.value = goodsDetail;\n  skuPopRef.value.open();\n};\n\nnextTick(() => {\n  calcSize();\n  if (categoryList) onClassTab(categoryList[0]);\n  console.log(categoryList);\n});\nconsole.log(unref(containerHeight));\n</script>\n\n<template>\n  <view class=\"page-wrap\">\n    <mod-nav-bar title=\"商品分类\" title-color=\"#ffffff\"></mod-nav-bar>\n    <mode-search></mode-search>\n    <view class=\"container\">\n      <scroll-view class=\"aside\" scroll-y>\n        <view\n          class=\"item\"\n          :class=\"{ active: item._id == currentClassId }\"\n          v-for=\"(item, index) in categoryList\"\n          :key=\"item._id\"\n          @click=\"onClassTab(item)\"\n          >{{ item.name }}</view\n        >\n      </scroll-view>\n      <scroll-view\n        class=\"main\"\n        scroll-y\n        :scroll-top=\"mainScrollTop\"\n        scroll-with-animation\n        @scroll=\"onMainScroll\"\n      >\n        <view\n          class=\"group\"\n          v-for=\"(group, index) in categoryList\"\n          :key=\"group._id\"\n          :id=\"`module-${group._id}`\"\n        >\n          <view class=\"name\">{{ group.name }}</view>\n          <view class=\"list\">\n            <view\n              class=\"item\"\n              v-for=\"(goods, index) in group.goods\"\n              :key=\"goods._id\"\n            >\n              <card-goods-info\n                :info=\"goods\"\n                :type=\"1\"\n                @select-buy=\"showSkuPop\"\n              ></card-goods-info>\n            </view>\n          </view>\n        </view>\n      </scroll-view>\n    </view>\n\n    <view class=\"shop-bar\">\n      <view class=\"content\">\n        <view class=\"left\">\n          <view class=\"icon-wrap\">\n            <view class=\"iconfont icon-caigou\"></view>\n            <view class=\"tag\">33</view>\n          </view>\n          <view class=\"price-wrap\">\n            <text>合计：</text>\n            <text class=\"num\">￥888.00</text>\n          </view>\n        </view>\n        <view class=\"right\">\n          <view class=\"settle\">去结算</view>\n        </view>\n      </view>\n    </view>\n\n    <uni-popup ref=\"skuPopRef\" type=\"bottom\" :mask=\"true\">\n      <view class=\"sku-pop-wrap\">\n        <shop-sku :info=\"currentGoods\"></shop-sku>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n.page-wrap {\n  .container {\n    display: flex;\n    justify-content: space-between;\n    height: v-bind(containerHeight);\n\n    .aside {\n      width: 200rpx;\n      height: 100%;\n      background: #f9f9f9;\n      flex-shrink: 0;\n\n      .item {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 100%;\n        height: 100rpx;\n        font-size: 28rpx;\n        color: #666;\n        position: relative;\n\n        &.active {\n          color: $uni-color-primary;\n          background: #fff;\n\n          &::after {\n            content: \"\";\n            display: block;\n            position: absolute;\n            left: 0;\n            top: 50%;\n            transform: translateY(-50%);\n            width: 8rpx;\n            height: 36rpx;\n            background: $uni-color-primary;\n            border-radius: 0 10rpx 10rpx 0;\n          }\n        }\n      }\n    }\n\n    .main {\n      flex: 1;\n      height: 100%;\n\n      .group {\n        .name {\n          font-size: 26rpx;\n          color: #333;\n          padding: 10rpx 24rpx;\n          position: sticky;\n          top: 0;\n          left: 0;\n          background: #fff;\n          font-weight: bold;\n        }\n\n        .list {\n          padding: 24rpx;\n          padding-top: 0;\n          display: grid;\n          gap: 24rpx;\n        }\n      }\n    }\n  }\n\n  .shop-bar {\n    position: fixed;\n    width: 100%;\n    left: 0;\n    //#ifdef H5\n    bottom: 50px;\n    //#endif\n    //#ifndef H5\n    bottom: 0;\n\n    //#endif\n    .content {\n      position: relative;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      width: 100%;\n      height: 100rpx;\n      padding: 0 24rpx;\n      box-sizing: border-box;\n      background-color: #6a6a6a;\n\n      .left {\n        display: flex;\n        align-items: center;\n        height: 100%;\n\n        .icon-wrap {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 112rpx;\n          height: 112rpx;\n          border-radius: 50%;\n          background-color: $uni-color-primary;\n          position: absolute;\n          top: -30rpx;\n          left: 24rpx;\n\n          .iconfont {\n            font-size: 50rpx;\n            color: #fff;\n          }\n\n          .tag {\n            position: absolute;\n            right: 0;\n            top: 0rpx;\n            min-width: 40rpx;\n            height: 40rpx;\n            padding: 10rpx;\n            font-size: 22rpx;\n            color: #fff;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background-color: $uni-color-error;\n            border-radius: 40rpx;\n          }\n        }\n\n        .price-wrap {\n          display: flex;\n          align-items: center;\n          margin-left: 120rpx;\n          color: #fff;\n          font-size: 22rpx;\n\n          .num {\n            font-size: 36rpx;\n          }\n        }\n      }\n\n      .right {\n        display: flex;\n        justify-content: flex-end;\n        align-items: center;\n        height: 100%;\n\n        .settle {\n          padding: 0 32rpx;\n          height: 66rpx;\n          line-height: 66rpx;\n          font-size: 32rpx;\n          color: #fff;\n          background-color: $uni-color-error;\n          border-radius: 66rpx;\n        }\n      }\n    }\n  }\n\n  .sku-pop-wrap,\n  .cart-pop-wrap {\n    background: #fff;\n    min-height: 300rpx;\n    padding: 32rpx;\n    /* #ifdef H5 */\n    padding: 32rpx 32rpx 66px;\n    /* #endif */\n    border-radius: 20rpx 20rpx 0 0;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/extest/IbukiSuikaShop-CLI/pages/shop/category.vue'\nwx.createPage(MiniProgramPage)"],"names":["useGoodsCategoryApi","useGoodsDetailApi","ref","computed","SYSTEM_WINDOW_INFO","unref","navBarH","uni","nextTick"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,UAAM,EAAE,MAAM,eAAe,GAAI,IAAGA,WAAmB,oBAAA;AACvD,UAAM,EAAE,MAAM,cAAc,GAAI,IAAGC,WAAiB,kBAAA;AAEpD,UAAM,iBAAiBC,cAAAA,IAAI,EAAE;AAC7B,UAAM,gBAAgBA,cAAAA,IAAI,CAAC;AAC3B,UAAM,YAAYA,cAAAA,IAAI,IAAI;AAC1B,UAAM,eAAeA,cAAAA,IAAI,CAAA,CAAE;AAE3B,UAAM,kBAAkBC,cAAQ,SAAC,MAAM;AACrC,UAAI,UAAU;AAKd,aAAO,GACLC,aAAAA,mBAAmB,eACnBC,cAAAA,MAAMC,aAAAA,OAAO,IACb,KACAC,cAAG,MAAC,OAAO,GAAG,IACd,OACD;AAAA,IACH,CAAC;AAED,UAAM,aAAa,CAAC,SAAS;AAC3BA,oBAAA,MAAA,MAAA,OAAA,iCAAY,sBAAsB,IAAI;AACtC,qBAAe,QAAQ,KAAK;AAC5B,oBAAc,QAAQ,KAAK;AAAA,IAC7B;AAEA,UAAM,WAAW,MAAM;AACrB,UAAI,SAAS;AACb,mBAAa,QAAQ,CAAC,MAAM,UAAU;AACpC,cAAM,OAAOA,oBAAI,sBAAsB,OAAO,WAAW,KAAK,GAAG,EAAE;AACnE,aACG,OAAO,EAAE,MAAM,KAAM,GAAE,CAAC,SAAS;AAChC,eAAK,MAAM,KAAK,MAAM,MAAM;AAC5B,oBAAU,KAAK;AAAA,QACvB,CAAO,EACA;MACP,CAAG;AACD,aAAO;AAAA,IACT;AAEA,UAAM,eAAe,CAAC,MAAM;AAC1B,UAAI,YAAY,EAAE,OAAO;AACzB,UAAI,UAAU,aAAa,OAAO,CAAC,SAAS,KAAK,OAAO,SAAS,EAAE;AACnEA,oBAAAA,MAAY,MAAA,OAAA,iCAAA,OAAO;AACnB,UAAI,QAAQ,SAAS;AAAG,uBAAe,QAAQ,QAAQ,CAAC,EAAE;AAAA,IAC5D;AAEA,UAAM,aAAa,CAAC,MAAM;AACxBA,oBAAAA,MAAA,MAAA,OAAA,iCAAY,CAAC;AACb,mBAAa,QAAQ;AACrB,gBAAU,MAAM;IAClB;AAEAC,kBAAAA,WAAS,MAAM;AACb;AACA,UAAI;AAAc,mBAAW,aAAa,CAAC,CAAC;AAC5CD,oBAAAA,MAAA,MAAA,OAAA,iCAAY,YAAY;AAAA,IAC1B,CAAC;AACDA,kBAAAA,MAAY,MAAA,OAAA,iCAAAF,cAAAA,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClElC,GAAG,WAAW,eAAe;"}